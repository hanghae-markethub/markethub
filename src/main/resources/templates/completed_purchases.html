<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Market Hub Purchase Page</title>
    <style>
        /* 기존 스타일에 추가할 스타일 */
        .purchase-list {
            margin: 0;
            padding: 0;
            list-style-type: none;
        }
        .purchase-list li {
            cursor: pointer;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .purchase-list li:hover {
            background-color: #f0f0f0;
        }
        .container {
            width: 600px;
            margin: 20px auto;
        }
        .info-section {
            background-color: #f8f8f8;
            padding: 15px;
            margin-bottom: 10px;
        }
        /* 상세 정보 섹션을 위한 스타일 */
        .details-section {
            background-color: #e9e9e9;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Market Hub</h1>
    <div id="purchaseList" class="info-section">
        <h2>주문 목록</h2>
        <ul class="purchase-list"></ul>
    </div>
    <div class="info-section">
        <h2>주문 상세 정보</h2>
        <div id="purchaseDetails"></div>
        <!-- 주문 상세 정보를 표시할 곳 -->
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetchPurchases();
    });

    function fetchPurchases() {
        const token = getCookie('Authorization');
        fetch('/api/purchase/searchAllPurchase', {
            headers: { 'Authorization': token }
        })
            .then(response => response.json())
            .then(data => {
                const listElement = document.getElementById('purchaseList').querySelector('.purchase-list');
                data.forEach(purchase => {
                    // 상태 텍스트 변환 로직 추가
                    const statusText = getStatusText(purchase.status);

                    const listItem = document.createElement('li');
                    listItem.textContent = `주문 번호: ${purchase.purchaseId}, 상품명: ${purchase.itemDetails.itemName}, 배송 상태: ${statusText}`;
                    listItem.onclick = () => fetchPurchaseDetails(purchase.purchaseId);
                    listElement.appendChild(listItem);
                });
            })
            .catch(error => console.error('Error fetching purchase list:', error));
    }

    function fetchPurchaseDetails(purchaseId) {
        const token = getCookie('Authorization');
        fetch(`/api/purchase/searchPurchase/${purchaseId}`, {
            headers: { 'Authorization': token }
        })
            .then(response => response.json())
            .then(data => {
                const formattedPrice = new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(data.itemDetails.price);
                const container = document.createElement('div');
                container.className = 'details-section';
                const statusText = getStatusText(data.status); // 상태 텍스트 변환 로직 적용
                container.innerHTML = `
                <p><strong>상품명:</strong> ${data.itemDetails.itemName}</p>
                <p><strong>수량:</strong> ${data.itemDetails.quantity}</p>
                <p><strong>가격:</strong> ${formattedPrice}</p>
                <p><strong>주문 상태:</strong> ${statusText}</p>
            `;

                // 기존에 추가된 상세 정보를 제거하고 새로운 상세 정보 추가
                const prevDetails = document.getElementById('purchaseDetails');
                prevDetails.innerHTML = ''; // 기존의 내용을 비워줌
                prevDetails.appendChild(container);
            })
            .catch(error => console.error('Error fetching purchase details:', error));
    }

    // 쿠키에서 특정 이름의 쿠키 값을 가져오는 함수
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    // 상태 코드를 사용자 친화적인 텍스트로 변환하는 함수
    function getStatusText(status) {
        switch(status) {
            case 'IN_DELIVERY':
                return '배송중';
            case 'DELIVERY_COMPLETE':
                return '배송완료';
            case 'ORDER_COMPLETE':
                return '주문완료';
            default:
                return '상태미정'; // 알 수 없는 상태에 대한 기본 텍스트
        }
    }
</script>
</body>
</html>
