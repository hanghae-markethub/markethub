<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Hub</title>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
</head>
<body>
<div id="user-info">
    <!-- 사용자 정보 표시 -->
    <h1>마이페이지</h1>
    <p id="email">이메일: </p>
    <p id="name">이름: </p>
    <p id="phone">전화번호: </p>
    <p id="address">주소: </p>
    <p id="role">역할: </p>
    <!-- 추가적인 사용자 정보 표시 -->
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // JWT 토큰에서 이메일 가져오기
        const token = getToken();
        const email = getEmailFromToken(token);

        // 이메일을 사용하여 사용자 정보 가져오기
        fetchUserInfo(email);
    });

    function getToken() {
        const token = Cookies.get('token');
        return token ? token : '';
    }

    function getEmailFromToken(token) {
        if (!token) return '';
        try {
            const payload = parseJwt(token);
            return payload.email;
        } catch (error) {
            console.error('Error parsing JWT:', error);
            return '';
        }
    }

    function parseJwt(token) {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
    }

    function fetchUserInfo(email) {
        if (!email) return;

        fetch('/api/user/info?email=' + email, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch user information');
                }
                return response.json();
            })
            .then(data => {
                displayUserInfo(data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    function displayUserInfo(userInfo) {
        document.getElementById('email').innerText += userInfo.email;
        document.getElementById('name').innerText += userInfo.name;
        document.getElementById('phone').innerText += userInfo.phone;
        document.getElementById('address').innerText += userInfo.address;
        document.getElementById('role').innerText += userInfo.role;
        // 추가적인 사용자 정보 표시
    }
</script>
</body>
</html>
